This document guides you through the process of upgrading Houdini. First, check if a section named "Upgrade to x.x.x" exists, with x.x.x being the version you are planning to upgrade to.

## Upgrade to 4.0.0

4.0.0 uses Symfony 5.4, which has differences from 3.x.x which used Symfony 4.4.
This makes it non-backwards compatible and requires testing of any custom changes you
may have made.

Houdini relies on Crayfish-Commons `^4.0` which no longer includes our own JWT authentication,
to perform JWT authentication we use the [Lexik JWT Bundle](https://github.com/lexik/LexikJWTAuthenticationBundle).

### Upgrade from version 3.x.x

You can remove the `syn_config:` line from the `./config/packages/crayfish_commons.yaml` file.

You will need to make a file in `./config/packages` called `lexik_jwt_authentication.yaml`.

The file needs to contain (at a minimum) or you can copy the file from the Github repository:
```yaml
lexik_jwt_authentication:
    # This is the public key from the pair generated by Drupal and is required to validate the JWTs
    public_key: '%env(resolve:JWT_PUBLIC_KEY)%'
    # By default lexik_jwt looks for the username key in the payload, we use sub
    user_identity_field: sub
```

You can either:
* define an [environment variables](https://symfony.com/doc/5.4/configuration.html#configuration-based-on-environment-variables) for
  the `JWT_PUBLIC_KEY` variable defined above and pointed to the Drupal public key file

_or_
* explicitly overwrite the `'%env(resolve:JWT_PUBLIC_KEY)%'` in
  the above file and specify the path to the Drupal public key
